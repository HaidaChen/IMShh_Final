<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.douniu.imshh.finance.storage.dao.IMaterialInDao">
    <resultMap type="MaterialIn" id="materialinmap">
        <result property="id" column="id"/>
        <result property="receiveDate" column="receiveDate"/>
        <result property="orderIdentify" column="orderIdentify"/>
        <result property="supplierId" column="supplierId"/>
        <result property="supplierName" column="supplierName"/>
        <result property="materialId" column="materialId"/>
        <result property="materialName" column="materialName"/>
        <result property="specification1" column="specification1"/>
        <result property="specification2" column="specification2"/>
        <result property="specification3" column="specification3"/>
        <result property="formula" column="formula"/>
        <result property="unit" column="unit"/>
        <result property="meterage" column="meterage"/>
        <result property="amount" column="amount"/>
        <result property="unitPrice" column="unitPrice"/>        
        <result property="totlemnt" column="totlemnt"/>
        <result property="remark" column="remark"/>
    </resultMap>
    
    
    <select id="query" parameterType="MaterialIn" resultMap="materialinmap">
    	select * from T_MATERIALIN where status = 1
        <if test="condition != null and condition !=''">
          and (orderIdentify like #{condition}
            or supplierName like #{condition}
            or materialName like #{condition})
        </if>
        <if test="startDate != null">
          and receiveDate &gt;= #{startDate}
        </if>
        <if test="endDate != null">
          and receiveDate &lt;= #{endDate}
        </if>
          order by modifydate desc
          limit #{pageOffset},#{pageSize}
    </select>
    
    <select id="queryNoPage" parameterType="MaterialIn" resultMap="materialinmap">
    	select * from T_MATERIALIN where status = 1
        <if test="condition != null and condition !=''">
          and (orderIdentify like #{condition}
            or supplierName like #{condition}
            or materialName like #{condition})
        </if>
        <if test="startDate != null">
          and receiveDate &gt;= #{startDate}
        </if>
        <if test="endDate != null">
          and receiveDate &lt;= #{endDate}
        </if>
    </select>
    
    <select id="count" parameterType="MaterialIn" resultType="int">
    	select count(1) from T_MATERIALIN where status = 1
        <if test="condition != null and condition !=''">
          and (orderIdentify like #{condition}
            or supplierName like #{condition}
            or materialName like #{condition})
        </if>
        <if test="startDate != null">
          and receiveDate &gt;= #{startDate}
        </if>
        <if test="endDate != null">
          and receiveDate &lt;= #{endDate}
        </if>
    </select>
    
    <select id="queryBySupplier" parameterType="MaterialIn" resultMap="materialinmap">
    	select * from T_MATERIALIN where status = 1
        <if test="supplierName != null and supplierName !=''">
          and supplierName like #{supplierName}
        </if>
        <if test="startDate != null">
          and receiveDate &gt;= #{startDate}
        </if>
        <if test="endDate != null">
          and receiveDate &lt;= #{endDate}
        </if>
          order by modifydate desc
          limit #{pageOffset},#{pageSize}
    </select>
    
    <select id="countBySupplier" parameterType="MaterialIn" resultType="int">
    	select count(1) from T_MATERIALIN where status = 1
        <if test="supplierName != null and supplierName !=''">
          and supplierName like #{supplierName}
        </if>
        <if test="startDate != null">
          and receiveDate &gt;= #{startDate}
        </if>
        <if test="endDate != null">
          and receiveDate &lt;= #{endDate}
        </if>
    </select>
    
    <select id="findById" parameterType="String" resultType="MaterialIn">
        select * from T_MATERIALIN where id = #{id}
    </select>
    
    <insert id="insert" parameterType="MaterialIn">        
        insert into T_MATERIALIN(id, receiveDate, orderIdentify, supplierId, supplierName, materialName, materialId, specification1, specification2, specification3, formula, unit, meterage, unitPrice, amount, totlemnt, remark, modifyDate, status) 
             values (#{id} , #{receiveDate}, #{orderIdentify}, #{supplierId}, #{supplierName}, #{materialName}, #{materialId}, #{specification1}, #{specification2}, #{specification3}, #{formula}, #{unit}, #{meterage}, #{unitPrice}, #{amount}, #{totlemnt}, #{remark}, sysdate(), '1')
    </insert>
    
    <insert id="batchInsert" parameterType="java.util.List">        
        insert into T_MATERIALIN(id, receiveDate, orderIdentify, supplierId, supplierName, materialName, materialId, specification1, specification2, specification3, formula, unit, meterage, unitPrice, amount, totlemnt, remark, modifyDate, status) 
             values 
             <foreach collection="list" item="rep" index="index" separator=",">
             	(CONCAT(current_timestamp()+1, #{index}), #{rep.receiveDate}, #{rep.orderIdentify}, #{rep.supplierId}, #{rep.supplierName}, #{rep.materialName}, #{rep.materialId}, #{rep.specification1}, #{rep.specification2}, #{rep.specification3}, #{rep.formula}, #{rep.unit}, #{rep.meterage}, #{rep.unitPrice}, #{rep.amount}, #{rep.totlemnt}, #{rep.remark}, sysdate(), '1')
    		 </foreach>
    </insert>
    
    <update id="update" parameterType="MaterialIn">
        update T_MATERIALIN set 
          receiveDate = #{receiveDate},
          orderIdentify = #{orderIdentify},
          supplierId = #{supplierId},          
          supplierName = #{supplierName},
          materialName = #{materialName},
          materialId = #{materialId},
          specification1 = #{specification1},
          specification2 = #{specification2},
          specification3 = #{specification3},
          formula = #{formula},
          unit = #{unit},
          meterage = #{meterage},
          amount = #{amount},
          unitPrice = #{unitPrice},
          totlemnt = #{totlemnt},
          modifydate = sysdate(),
          remark = #{remark}
    where id = #{id}
    </update>    
    
    <update id="delete" parameterType="String">
        update T_MATERIALIN set 
               status = '0',
               modifydate = sysdate()
         where id = #{id}
    </update>
    
</mapper>